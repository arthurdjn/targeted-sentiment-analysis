


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>sentarget.optim.tuner &mdash; SenTarget 0.1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <!-- <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" /> -->
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

  <!-- Preload the theme fonts -->

<link rel="preload" href="../../../_static/fonts/FreightSans/freight-sans-book.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../_static/fonts/FreightSans/freight-sans-medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../_static/fonts/IBMPlexMono/IBMPlexMono-Medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../_static/fonts/FreightSans/freight-sans-bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../_static/fonts/FreightSans/freight-sans-medium-italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../_static/fonts/IBMPlexMono/IBMPlexMono-SemiBold.woff2" as="font" type="font/woff2" crossorigin="anonymous">

<!-- Preload the katex fonts -->

<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Math-Italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size1-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size4-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size2-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size3-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Caligraphic-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
</head>

<div class="container-fluid header-holder tutorials-header" id="header-holder">
  <div class="container">
    <div class="header-container">
      <a class="header-logo" href="https://pages.github.uio.no/arthurd/in5550-exam/" aria-label="PyTorch"></a>

      <div class="main-menu">
        <ul>
          <li>
            <a href="https://pages.github.uio.no/arthurd/in5550-exam/source/getting-started.html">Get Started</a>
          </li>

          <li>
            <a href="https://arthurdujardin.com/projects/sentarget.html">Blog</a>
          </li>

          <li>
            <a href="https://pages.github.uio.no/arthurd/in5550-exam/source/tutorial.html">Tutorials</a>
          </li>

          <li>
            <a href="https://pages.github.uio.no/arthurd/in5550-exam/">Docs</a>
          </li>

          <li>
            <a href="https://github.uio.no/arthurd/in5550-exam">Github</a>
          </li>
        </ul>
      </div>

      <a class="main-menu-open-button" href="#" data-behavior="open-mobile-menu"></a>
    </div>
  </div>
</div>


<body class="pytorch-body">

   

    

    <div class="table-of-contents-link-wrapper">
      <span>Table of Contents</span>
      <a href="#" class="toggle-table-of-contents" data-behavior="toggle-table-of-contents"></a>
    </div>

    <nav data-toggle="wy-nav-shift" class="pytorch-left-menu" id="pytorch-left-menu">
      <div class="pytorch-side-scroll">
        <div class="pytorch-menu pytorch-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          <div class="pytorch-left-menu-search">
            

            
              
              
            

            


  


<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search Docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

            
          </div>

          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../source/getting-started.html">Set-up</a></li>
</ul>
<p class="caption"><span class="caption-text">Data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../source/data.html">Data</a></li>
</ul>
<p class="caption"><span class="caption-text">Model</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../source/model.html">Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/model.html#solver">Solver</a></li>
</ul>
<p class="caption"><span class="caption-text">Grid Search</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../source/gridsearch.html">Grid Search</a></li>
</ul>
<p class="caption"><span class="caption-text">Package</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../source/package.html">sentarget</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/package.html#sentarget-nn">sentarget.nn</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/package.html#sentarget-nn-models">sentarget.nn.models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/package.html#sentarget-metrics">sentarget.metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/package.html#sentarget-tuner">sentarget.tuner</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/package.html#sentarget-datasets">sentarget.datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/package.html#sentarget-utils">sentarget.utils</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <div class="pytorch-container">
      <div class="pytorch-page-level-bar" id="pytorch-page-level-bar">
        <div class="pytorch-breadcrumbs-wrapper">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="pytorch-breadcrumbs">
    
      <li>
        <a href="../../../index.html">
          
            Docs
          
        </a> &gt;
      </li>

        
          <li><a href="../../index.html">Module code</a> &gt;</li>
        
      <li>sentarget.optim.tuner</li>
    
    
      <li class="pytorch-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
</div>
        </div>

        <div class="pytorch-shortcuts-wrapper" id="pytorch-shortcuts-wrapper">
          Shortcuts
        </div>
      </div>

      <section data-toggle="wy-nav-shift" id="pytorch-content-wrap" class="pytorch-content-wrap">
        <div class="pytorch-content-left">

        
          
          <div class="rst-content">
          
            <div role="main" class="main-content" itemscope="itemscope" itemtype="http://schema.org/Article">
             <article itemprop="articleBody" id="pytorch-article" class="pytorch-article">
              
  <h1>Source code for sentarget.optim.tuner</h1><div class="highlight"><pre>
<span></span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Hyperparameters optimization using a grid search algorithm.</span>
<span class="sd">Basically, you need to provide a set of parameters that will be modified.</span>
<span class="sd">The grid search will run on all permutations from the set of parameters provided.</span>
<span class="sd">Usually, you modify the hyperparameters and models&#39; modules (ex, dropout etc.).</span>
<span class="sd">In addition, if you are using custom losses or optimizer that needs additional arguments / parameters,</span>
<span class="sd">you can provide them through the specific dictionaries (see the documentation of ``Tuner``).</span>


<span class="sd">Examples:</span>

<span class="sd">.. code-block:: python</span>

<span class="sd">    # Hyper parameters to tune</span>
<span class="sd">    params = {&#39;epochs&#39;: [150],</span>
<span class="sd">              &#39;lr&#39;: np.arange(0.001, 0.3, 0.01).tolist(),     # Make sure to convert it to a list (for saving after)</span>
<span class="sd">              &#39;optimizer&#39;: [&#39;torch.optim.Adam&#39;],</span>
<span class="sd">              &#39;criterion&#39;: [&#39;torch.nn.CrossEntropyLoss&#39;]}</span>

<span class="sd">    # Parameters affecting the models</span>
<span class="sd">    params_model = {&#39;hidden_dim&#39;: [100, 150, 200, 250],      # Model attribute</span>
<span class="sd">                    &#39;n_layers&#39;: [1, 2, 3],                   # Model attribute</span>
<span class="sd">                    &#39;bidirectional&#39;: [False, True],          # Model attribute</span>
<span class="sd">                    &#39;LSTM.dropout&#39;: [0.2, 0.3, 0.4, 0.6],    # Modify all LSTM dropout</span>
<span class="sd">                    # ...</span>
<span class="sd">                    }</span>

<span class="sd">    # Default parameters that will be used</span>
<span class="sd">    params_loss = {&#39;ignore_index&#39;: PAD_IDX}</span>
<span class="sd">    params_optim = {}</span>

<span class="sd">    tuner = Tuner(params, params_loss=params_loss, params_optim=params_optim)</span>

<span class="sd">    # Grid Search</span>
<span class="sd">    tuner.run([BiGRU, BiLSTM], train_iterator, eval_iterator, verbose=True)</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">torch</span>

<span class="kn">from</span> <span class="nn">.functional</span> <span class="kn">import</span> <span class="n">tune</span><span class="p">,</span> <span class="n">tune_optimizer</span><span class="p">,</span> <span class="n">permutation_dict</span><span class="p">,</span> <span class="n">init_cls</span>
<span class="kn">from</span> <span class="nn">sentarget.utils</span> <span class="kn">import</span> <span class="n">describe_dict</span><span class="p">,</span> <span class="n">serialize_dict</span>


<div class="viewcode-block" id="Tuner"><a class="viewcode-back" href="../../../source/package.html#sentarget.optim.tuner.Tuner">[docs]</a><span class="k">class</span> <span class="nc">Tuner</span><span class="p">:</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The ``Tuner`` class is used for hyper parameters tuning.</span>
<span class="sd">    From a set of models and parameters to tune, this class will look at the best model&#39;s performance.</span>

<span class="sd">    .. note::</span>

<span class="sd">        To facilitate the search and hyperameters tuning, it is recommended to use the</span>
<span class="sd">        ``sentarget.models.Model`` abstract class as parent class for all of your models.</span>


<span class="sd">    * :attr:`hyper_params` (dict): dictionary of hyperparameters to tune.</span>

<span class="sd">    * :attr:`performance` (dict): dictionary of all models&#39; performances.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">params_model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">params_loss</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">params_optim</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># Hyper parameters with default values</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">params</span> <span class="k">if</span> <span class="n">params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;epochs&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">],</span>
                       <span class="s1">&#39;batch_size&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">64</span><span class="p">],</span>
                       <span class="s1">&#39;criterion&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">CrossEntropyLoss</span><span class="p">],</span>
                       <span class="s1">&#39;optimizer&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">],</span>
                       <span class="o">**</span><span class="n">params</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params_model</span> <span class="o">=</span> <span class="n">params_model</span> <span class="k">if</span> <span class="n">params_model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params_loss</span> <span class="o">=</span> <span class="n">params_loss</span> <span class="k">if</span> <span class="n">params_loss</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params_optim</span> <span class="o">=</span> <span class="n">params_optim</span> <span class="k">if</span> <span class="n">params_optim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">{}</span>
        <span class="c1"># Keep track of all performances</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">best_model</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="Tuner.run"><a class="viewcode-back" href="../../../source/package.html#sentarget.optim.tuner.Tuner.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">models</span><span class="p">,</span> <span class="n">train_data</span><span class="p">,</span> <span class="n">eval_data</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">saves</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dirsaves</span><span class="o">=</span><span class="s1">&#39;gridsearch&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Run the hyper parameters tuning.</span>

<span class="sd">        Args:</span>
<span class="sd">            models (iterable): list of type of models to perform the grid search.</span>
<span class="sd">            train_data (iterator): training dataset.</span>
<span class="sd">            eval_data (iterator): dev dataset.</span>
<span class="sd">            verbose (bool): if ``True``, display a statistical log at each search.</span>
<span class="sd">            saves (bool): if ``True`` saves all trained models.</span>


<span class="sd">        Examples::</span>

<span class="sd">            &gt;&gt;&gt; from sentarget.optim import Tuner</span>
<span class="sd">            &gt;&gt;&gt; from sentarget.models.lstm import BiLSTM</span>
<span class="sd">            &gt;&gt;&gt; from sentarget.models.gru import BiGRU</span>

<span class="sd">            &gt;&gt;&gt; # Hyper parameters to tune</span>
<span class="sd">            &gt;&gt;&gt; tuner = Tuner(</span>
<span class="sd">            ...                 {&#39;epochs&#39;: [2, 3],</span>
<span class="sd">            ...                  &#39;lr&#39;: [0.01],</span>
<span class="sd">            ...                  &#39;optimizer&#39;: [&#39;torch.optim.Adam&#39;],</span>
<span class="sd">            ...                  &#39;criterion&#39;: [&#39;torch.nn.CrossEntropyLoss&#39;],</span>
<span class="sd">            ...                  &#39;vectors&#39;: [&#39;model.txt&#39;]}</span>
<span class="sd">            ... )</span>
<span class="sd">            &gt;&gt;&gt; # train_iterator = torchtext data iterato</span>
<span class="sd">            &gt;&gt;&gt; tuner.run([BiLSTM, BiGRU], train_iterator, valid_iterator)</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># models should be iterable</span>
        <span class="c1"># However for convenience, it is authorized to tune only one type of models</span>
        <span class="n">models</span> <span class="o">=</span> <span class="n">models</span> <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">models</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">models</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span> <span class="k">else</span> <span class="p">[</span><span class="n">models</span><span class="p">]</span>

        <span class="n">configs_hyper</span> <span class="o">=</span> <span class="n">permutation_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
        <span class="n">configs_model</span> <span class="o">=</span> <span class="n">permutation_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params_model</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Tuning...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;GridSearch(&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  (session): Parameters(numbers: {len(models) * len(configs_hyper) * len(configs_model)})&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;)</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">class_model</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">models</span><span class="p">):</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">config_hyper</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">configs_hyper</span><span class="p">):</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">config_model</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">configs_model</span><span class="p">):</span>
                    <span class="c1"># Set a batch size to the data</span>
                    <span class="n">train_data</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">=</span> <span class="n">config_hyper</span><span class="p">[</span><span class="s1">&#39;batch_size&#39;</span><span class="p">]</span>
                    <span class="n">eval_data</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">=</span> <span class="n">config_hyper</span><span class="p">[</span><span class="s1">&#39;batch_size&#39;</span><span class="p">]</span>
                    <span class="c1"># Initialize the model from arguments that are in config_model</span>
                    <span class="n">model</span> <span class="o">=</span> <span class="n">init_cls</span><span class="p">(</span><span class="n">class_model</span><span class="p">,</span> <span class="n">config_model</span><span class="p">)</span>
                    <span class="c1"># Change modules values that were not saved as attributes</span>
                    <span class="n">tune</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">config_model</span><span class="p">)</span>
                    <span class="c1"># Load the criterion and optimizer, with their parameters</span>
                    <span class="n">criterion</span> <span class="o">=</span> <span class="n">config_hyper</span><span class="p">[</span><span class="s1">&#39;criterion&#39;</span><span class="p">](</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">params_loss</span><span class="p">)</span>
                    <span class="n">optimizer</span> <span class="o">=</span> <span class="n">config_hyper</span><span class="p">[</span><span class="s1">&#39;optimizer&#39;</span><span class="p">](</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">params_optim</span><span class="p">)</span>
                    <span class="n">tune_optimizer</span><span class="p">(</span><span class="n">optimizer</span><span class="p">,</span> <span class="n">config_hyper</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Search n°{i + j + k + 1}: </span><span class="si">{class_model.__name__}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Configuration(&quot;</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  (hyper): Variables({describe_dict(config_hyper, key_length=20, capitalize=False, pad=False, sep=&#39;, &#39;)})&quot;</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  (model): Parameters({describe_dict(config_model, key_length=20, capitalize=False, pad=False, sep=&#39;, &#39;)})&quot;</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  (criterion): Parameters({describe_dict(self.params_loss, key_length=20, capitalize=False, pad=False, sep=&#39;, &#39;)})&quot;</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  (optimizer): Parameters({describe_dict(self.params_optim, key_length=20, capitalize=False, pad=False, sep=&#39;, &#39;)})&quot;</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

                    <span class="c1"># Train the model</span>
                    <span class="n">best_model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_data</span><span class="p">,</span> <span class="n">eval_data</span><span class="p">,</span>
                                           <span class="n">criterion</span><span class="o">=</span><span class="n">criterion</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="n">config_hyper</span><span class="p">[</span><span class="s1">&#39;epochs&#39;</span><span class="p">],</span>
                                           <span class="o">**</span><span class="p">{</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;verbose&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span>
                    <span class="c1"># ...and save the results</span>
                    <span class="n">results</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;performance&#39;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">performance</span><span class="p">,</span>
                               <span class="s1">&#39;state_dict&#39;</span><span class="p">:</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">state_json</span><span class="p">()),</span>
                               <span class="s1">&#39;hyper&#39;</span><span class="p">:</span> <span class="n">config_hyper</span><span class="p">,</span>
                               <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="n">config_model</span><span class="p">,</span>
                               <span class="s1">&#39;optimizer&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">params_optim</span><span class="p">,</span>
                               <span class="s1">&#39;criterion&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">params_loss</span><span class="p">}</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">serialize_dict</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>

                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                        <span class="n">describe_train</span><span class="p">,</span> <span class="n">describe_eval</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">describe_performance</span><span class="p">(</span><span class="n">key_length</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">capitalize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;, &#39;</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Performances(&quot;</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  (results train): Scores(</span><span class="si">{describe_train}</span><span class="s2">)&quot;</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  (results eval): Scores(</span><span class="si">{describe_eval}</span><span class="s2">)&quot;</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;)</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">saves</span><span class="p">:</span>
                        <span class="n">model_name</span> <span class="o">=</span> <span class="n">class_model</span><span class="o">.</span><span class="vm">__name__</span>
                        <span class="n">search</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;search_{i + j + k + 1}&quot;</span>
                        <span class="n">dirpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirsaves</span><span class="p">,</span> <span class="s1">&#39;saves&#39;</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">search</span><span class="p">)</span>
                        <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;best_</span><span class="si">{model_name}</span><span class="s2">{i + j + k + 1}&quot;</span>
                        <span class="c1"># Save the best model and its checkpoint</span>
                        <span class="n">best_model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">dirpath</span><span class="o">=</span><span class="n">dirpath</span><span class="p">)</span>
                        <span class="c1"># Save the last model&#39;s state</span>
                        <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{model_name}</span><span class="s2">{i + j + k + 1}&quot;</span>
                        <span class="n">model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">dirpath</span><span class="o">=</span><span class="n">dirpath</span><span class="p">)</span>
                        <span class="c1"># Save the model&#39;s results and configs</span>
                        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="s1">&#39;results.json&#39;</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
                            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">serialize_dict</span><span class="p">(</span><span class="n">results</span><span class="p">),</span> <span class="n">outfile</span><span class="p">)</span></div>

<div class="viewcode-block" id="Tuner.save"><a class="viewcode-back" href="../../../source/package.html#sentarget.optim.tuner.Tuner.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;gridsearch.json&#39;</span><span class="p">,</span> <span class="n">dirpath</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Save the performances as a json file, by default.</span>

<span class="sd">        Args:</span>
<span class="sd">            filename (string): name of the file to save.</span>
<span class="sd">            dirpath (string): path to the saving directory.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;results&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">}</span>

        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span></div></div>
</pre></div>

             </article>
             
            </div>
            <footer>
  

  

    <hr>

  

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Lotte Boerboom, Silvia N. W. Hertzberg, Arthur Dujardin.

    </p>
  </div>
    
      <div>
        Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
      </div>
     

</footer>

          </div>
        </div>

        <div class="pytorch-content-right" id="pytorch-content-right">
          <div class="pytorch-right-menu" id="pytorch-right-menu">
            <div class="pytorch-side-scroll" id="pytorch-side-scroll-right">
              
            </div>
          </div>
        </div>
      </section>
    </div>

  


  

     
       <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
         <script src="../../../_static/jquery.js"></script>
         <script src="../../../_static/underscore.js"></script>
         <script src="../../../_static/doctools.js"></script>
         <script src="../../../_static/language_data.js"></script>
         <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
     

  

  <script type="text/javascript" src="../../../_static/js/vendor/popper.min.js"></script>
  <script type="text/javascript" src="../../../_static/js/vendor/bootstrap.min.js"></script>
  <script type="text/javascript" src="../../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

  <!-- Begin Footer -->

  <div class="container-fluid docs-tutorials-resources" id="docs-tutorials-resources">
    <div class="container">
      <div class="row">
        <div class="col-md-4 text-center">
          <h2>Docs</h2>
          <p>Access comprehensive developer documentation for PyTorch</p>
          <a class="with-right-arrow" href="https://pages.github.uio.no/arthurd/in5550-exam/">View Docs</a>
        </div>

        <div class="col-md-4 text-center">
          <h2>Tutorials</h2>
          <p>Get in-depth tutorials for beginners and advanced developers</p>
          <a class="with-right-arrow" href="https://pages.github.uio.no/arthurd/in5550-exam/source/tutorial.html">View Tutorials</a>
        </div>

        <div class="col-md-4 text-center">
          <h2>Resources</h2>
          <p>Check the GitHub page and contribute to the project</p>
          <a class="with-right-arrow" href="https://pages.github.uio.no/arthurd/in5550-exam/source/package.html">View GitHub</a>
        </div>
      </div>
    </div>
  </div>

  <footer class="site-footer">
    <div class="container footer-container">
      <div class="footer-logo-wrapper">
        <a href="https://pages.github.uio.no/arthurd/in5550-exam/" class="footer-logo"></a>
      </div>

      <div class="footer-links-wrapper">
        <div class="footer-links-col">
          <ul>
            <li class="list-title"><a href="https://pages.github.uio.no/arthurd/in5550-exam/">PyTorch</a></li>
            <li><a href="https://pages.github.uio.no/arthurd/in5550-exam/source/getting-started.html">Get Started</a></li>
            <li><a href="https://arthurdujardin.com/projects/sentarget.html">Blog</a></li>
          </ul>
        </div>

        <div class="footer-links-col">
          <ul>
            <li><a href="https://pages.github.uio.no/arthurd/in5550-exam/source/tutorial.html">Tutorials</a></li>
            <li><a href="https://pages.github.uio.no/arthurd/in5550-exam/">Docs</a></li>
            <li><a href="https://github.uio.no/arthurd/in5550-exam/issues" target="_blank">Github Issues</a></li>
          </ul>
        </div>

      </div>
    </div>
  </footer>

  <div class="cookie-banner-wrapper">
  <div class="container">
    <p class="gdpr-notice">To analyze traffic and optimize your experience, we serve cookies on this site. By clicking or navigating, you agree to allow our usage of cookies. As the current maintainers of this site, Facebook’s Cookies Policy applies. Learn more, including about available controls: <a href="https://www.facebook.com/policies/cookies/">Cookies Policy</a>.</p>
    <img class="close-button" src="../../../_static/images/pytorch-x.svg">
  </div>
</div>

  <!-- End Footer -->

  <!-- Begin Mobile Menu -->

  <div class="mobile-main-menu">
    <div class="container-fluid">
      <div class="container">
        <div class="mobile-main-menu-header-container">
          <a class="header-logo" href="https://pages.github.uio.no/arthurd/in5550-exam/" aria-label="PyTorch"></a>
          <a class="main-menu-close-button" href="#" data-behavior="close-mobile-menu"></a>
        </div>
      </div>
    </div>

    <div class="mobile-main-menu-links-container">
      <div class="main-menu">
        <ul>
          <li>
            <a href="https://pages.github.uio.no/arthurd/in5550-exam/source/getting-started.html">Get Started</a>
          </li>


          <li>
            <a href="https://arthurdujardin.com/projects/sentarget.html">Blog</a>
          </li>

          <li>
            <a href="https://pages.github.uio.no/arthurd/in5550-exam/source/tutorial.html">Tutorials</a>
          </li>

          <li>
            <a href="https://pages.github.uio.no/arthurd/in5550-exam/">Docs</a>
          </li>

          <li>
            <a href="https://github.uio.no/arthurd/in5550-exam">Github</a>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- End Mobile Menu -->

  <script type="text/javascript" src="../../../_static/js/vendor/anchor.min.js"></script>

  <script type="text/javascript">
    $(document).ready(function() {
      mobileMenu.bind();
      mobileTOC.bind();
      pytorchAnchors.bind();
      sideMenus.bind();
      scrollToAnchor.bind();
      highlightNavigation.bind();
      mainMenuDropdown.bind();

      // Add class to links that have code blocks, since we cannot create links in code blocks
      $("article.pytorch-article a span.pre").each(function(e) {
        $(this).closest("a").addClass("has-code");
      });
    })
  </script>
</body>
</html>