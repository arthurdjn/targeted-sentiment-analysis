


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>sentarget.models.model &mdash; SenTarget 0.1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <!-- <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" /> -->
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

  <!-- Preload the theme fonts -->

<link rel="preload" href="../../../_static/fonts/FreightSans/freight-sans-book.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../_static/fonts/FreightSans/freight-sans-medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../_static/fonts/IBMPlexMono/IBMPlexMono-Medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../_static/fonts/FreightSans/freight-sans-bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../_static/fonts/FreightSans/freight-sans-medium-italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../_static/fonts/IBMPlexMono/IBMPlexMono-SemiBold.woff2" as="font" type="font/woff2" crossorigin="anonymous">

<!-- Preload the katex fonts -->

<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Math-Italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size1-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size4-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size2-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size3-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Caligraphic-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
</head>

<div class="container-fluid header-holder tutorials-header" id="header-holder">
  <div class="container">
    <div class="header-container">
      <a class="header-logo" href="https://pages.github.uio.no/arthurd/in5550-exam/" aria-label="PyTorch"></a>

      <div class="main-menu">
        <ul>
          <li>
            <a href="https://pages.github.uio.no/arthurd/in5550-exam/source/getting-started.html">Get Started</a>
          </li>

          <li>
            <a href="https://arthurdujardin.com/projects/sentarget.html">Blog</a>
          </li>

          <li>
            <a href="https://pages.github.uio.no/arthurd/in5550-exam/source/tutorial.html">Tutorials</a>
          </li>

          <li>
            <a href="https://pages.github.uio.no/arthurd/in5550-exam/">Docs</a>
          </li>

          <li>
            <a href="https://github.uio.no/arthurd/in5550-exam">Github</a>
          </li>
        </ul>
      </div>

      <a class="main-menu-open-button" href="#" data-behavior="open-mobile-menu"></a>
    </div>
  </div>
</div>


<body class="pytorch-body">

   

    

    <div class="table-of-contents-link-wrapper">
      <span>Table of Contents</span>
      <a href="#" class="toggle-table-of-contents" data-behavior="toggle-table-of-contents"></a>
    </div>

    <nav data-toggle="wy-nav-shift" class="pytorch-left-menu" id="pytorch-left-menu">
      <div class="pytorch-side-scroll">
        <div class="pytorch-menu pytorch-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          <div class="pytorch-left-menu-search">
            

            
              
              
            

            


  


<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search Docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

            
          </div>

          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../source/getting-started.html">Set-up</a></li>
</ul>
<p class="caption"><span class="caption-text">Data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../source/data.html">Data</a></li>
</ul>
<p class="caption"><span class="caption-text">Model</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../source/model.html">Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/model.html#solver">Solver</a></li>
</ul>
<p class="caption"><span class="caption-text">Grid Search</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../source/gridsearch.html">Grid Search</a></li>
</ul>
<p class="caption"><span class="caption-text">Package</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../source/package.html">sentarget</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/package.html#sentarget-nn">sentarget.nn</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/package.html#sentarget-nn-models">sentarget.nn.models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/package.html#sentarget-metrics">sentarget.metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/package.html#sentarget-tuner">sentarget.tuner</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/package.html#sentarget-datasets">sentarget.datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/package.html#sentarget-utils">sentarget.utils</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <div class="pytorch-container">
      <div class="pytorch-page-level-bar" id="pytorch-page-level-bar">
        <div class="pytorch-breadcrumbs-wrapper">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="pytorch-breadcrumbs">
    
      <li>
        <a href="../../../index.html">
          
            Docs
          
        </a> &gt;
      </li>

        
          <li><a href="../../index.html">Module code</a> &gt;</li>
        
      <li>sentarget.models.model</li>
    
    
      <li class="pytorch-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
</div>
        </div>

        <div class="pytorch-shortcuts-wrapper" id="pytorch-shortcuts-wrapper">
          Shortcuts
        </div>
      </div>

      <section data-toggle="wy-nav-shift" id="pytorch-content-wrap" class="pytorch-content-wrap">
        <div class="pytorch-content-left">

        
          
          <div class="rst-content">
          
            <div role="main" class="main-content" itemscope="itemscope" itemtype="http://schema.org/Article">
             <article itemprop="articleBody" id="pytorch-article" class="pytorch-article">
              
  <h1>Source code for sentarget.models.model</h1><div class="highlight"><pre>
<span></span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Defines a model template.</span>
<span class="sd">A `Model` is really similar to the `Module` class, except that a `Model` has more inner methods,</span>
<span class="sd">used to train, evaluate and test a neural network.</span>

<span class="sd">The *API* is similar to sklearn or tensorflow.</span>

<span class="sd">.. code-block:: python</span>

<span class="sd">    class Net(Model):</span>
<span class="sd">        def __init__(self, *args):</span>
<span class="sd">            super(Model, self).__init__()</span>
<span class="sd">            # initialize your module as usual</span>

<span class="sd">        def forward(*args):</span>
<span class="sd">            # one forward step</span>
<span class="sd">            pass</span>

<span class="sd">        def run(train_iterator, criterion, optimizer):</span>
<span class="sd">            # train one single time the network</span>
<span class="sd">            pass</span>

<span class="sd">        def evaluate(eval_iterator, criterion):</span>
<span class="sd">            # evaluate one single time the network</span>
<span class="sd">            pass</span>

<span class="sd">        def predict(test_iterator):</span>
<span class="sd">            # predict one single time the network</span>
<span class="sd">            pass</span>


<span class="sd">    # Run and train the model</span>
<span class="sd">    model = Net()</span>
<span class="sd">    model.fit(epochs, train_iterator, eval_iterator, criterion, optimizer)</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">abstractmethod</span><span class="p">,</span> <span class="n">ABC</span>

<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">torch.nn</span> <span class="k">as</span> <span class="nn">nn</span>
<span class="kn">import</span> <span class="nn">torch.optim</span> <span class="k">as</span> <span class="nn">optim</span>

<span class="c1"># Data science</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">from</span> <span class="nn">sentarget.utils</span> <span class="kn">import</span> <span class="n">append2dict</span><span class="p">,</span> <span class="n">describe_dict</span>


<div class="viewcode-block" id="Model"><a class="viewcode-back" href="../../../source/package.html#sentarget.models.model.Model">[docs]</a><span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">ABC</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A `Model` is used to define a neural network.</span>
<span class="sd">    This template is easier to handle for hyperparameters optimization, as the ``fit``, ``train``, ``evaluate``</span>
<span class="sd">    methods are part of the model.</span>

<span class="sd">    * :attr:`checkpoint` (dict): checkpoint of the best model tested.</span>

<span class="sd">    * :attr:`criterion` (Loss): loss function.</span>

<span class="sd">    * :attr:`optimizer` (Optimizer): optimizer for weights and biases.</span>

<span class="sd">    * :attr:`performance` (dict): dictionary where performances are stored.</span>

<span class="sd">        * ``&#39;train&#39;`` (dict): training dictionary.</span>
<span class="sd">        * ``&#39;eval&#39;`` (dict): testing dictionary.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="c1"># Performances</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkpoint</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">performance</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">inputs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

<div class="viewcode-block" id="Model.reset"><a class="viewcode-back" href="../../../source/package.html#sentarget.models.model.Model.reset">[docs]</a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reset the performance and associated checkpoint dictionary.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkpoint</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;epoch&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                           <span class="s1">&#39;model_name&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                           <span class="s1">&#39;model_state_dict&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                           <span class="s1">&#39;optimizer_name&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                           <span class="s1">&#39;criterion_name&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                           <span class="s1">&#39;optimizer_state_dict&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                           <span class="s1">&#39;train&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                           <span class="s1">&#39;eval&#39;</span><span class="p">:</span> <span class="kc">None</span>
                           <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">performance</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;train&quot;</span><span class="p">:</span> <span class="p">{},</span>
            <span class="s2">&quot;eval&quot;</span><span class="p">:</span> <span class="p">{}</span>
        <span class="p">}</span></div>

<div class="viewcode-block" id="Model.run"><a class="viewcode-back" href="../../../source/package.html#sentarget.models.model.Model.run">[docs]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iterator</span><span class="p">,</span> <span class="n">criterion</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Train one time the model on iterator data.</span>

<span class="sd">        Args:</span>
<span class="sd">            iterator (Iterator): iterator containing batch samples of data.</span>
<span class="sd">            criterion (Loss): loss function to measure scores.</span>
<span class="sd">            optimizer (Optimizer): optimizer used during training to update weights.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: the performance and metrics of the training session.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="Model.evaluate"><a class="viewcode-back" href="../../../source/package.html#sentarget.models.model.Model.evaluate">[docs]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iterator</span><span class="p">,</span> <span class="n">criterion</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Evaluate one time the model on iterator data.</span>

<span class="sd">        Args:</span>
<span class="sd">            iterator (Iterator): iterator containing batch samples of data.</span>
<span class="sd">            criterion (Loss): loss function to measure scores.</span>
<span class="sd">            optimizer (Optimizer): optimizer used during training to update weights.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: the performance and metrics of the training session.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="Model.predict"><a class="viewcode-back" href="../../../source/package.html#sentarget.models.model.Model.predict">[docs]</a>    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iterator</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Predict the model on iterator data.</span>

<span class="sd">        Args:</span>
<span class="sd">            iterator (Iterator): iterator containing batch samples of data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: the performance and metrics of the training session.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

    <span class="k">def</span> <span class="nf">_update_checkpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">epoch</span><span class="p">,</span> <span class="n">criterion</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">,</span> <span class="n">results_train</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">results_eval</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Update the model&#39;s checkpoint. Keep track of its epoch, state, optimizer,</span>
<span class="sd">        and performances. In addition, it saves the current model in `best_model`.</span>

<span class="sd">        Args:</span>
<span class="sd">            epoch (int): epoch at the current training state.</span>
<span class="sd">            criterion (Loss): loss function to measure scores.</span>
<span class="sd">            optimizer (Optimizer): optimizer used during training to update weights.</span>
<span class="sd">            results_train (dict, optional): metrics for the training session at epoch. The default is ``None``.</span>
<span class="sd">            results_eval (dict, optional): metrics for the evaluation session at epoch. The default is ``None``.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkpoint</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;epoch&#39;</span><span class="p">:</span> <span class="n">epoch</span><span class="p">,</span>
                           <span class="s1">&#39;model_name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                           <span class="s1">&#39;model_state_dict&#39;</span><span class="p">:</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">()),</span>
                           <span class="s1">&#39;optimizer_name&#39;</span><span class="p">:</span> <span class="n">optimizer</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                           <span class="s1">&#39;criterion_name&#39;</span><span class="p">:</span> <span class="n">criterion</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                           <span class="s1">&#39;train&#39;</span><span class="p">:</span> <span class="n">results_train</span><span class="p">,</span>
                           <span class="s1">&#39;eval&#39;</span><span class="p">:</span> <span class="n">results_eval</span>
                           <span class="p">}</span>

<div class="viewcode-block" id="Model.save"><a class="viewcode-back" href="../../../source/package.html#sentarget.models.model.Model.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dirpath</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">checkpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Save the best torch model.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str, optional): name of the model. The default is &quot;model.pt&quot;.</span>
<span class="sd">            dirpath (str, optional): path to the desired foldre location. The default is &quot;.&quot;.</span>
<span class="sd">            checkpoint (bool, optional): True to save the model at the best checkpoint during training.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get the name and other relevant information</span>
        <span class="n">model_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">name</span>
        <span class="n">epoch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkpoint</span><span class="p">[</span><span class="s1">&#39;epoch&#39;</span><span class="p">]</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;model_</span><span class="si">{model_name}</span><span class="s2">_epoch</span><span class="si">{epoch}</span><span class="s2">.pt&quot;</span>
        <span class="c1"># Save in the appropriate directory, and create it if it doesn&#39;t exists</span>
        <span class="n">Path</span><span class="p">(</span><span class="n">dirpath</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>

        <span class="c1"># Save its checkpoint</span>
        <span class="k">if</span> <span class="n">checkpoint</span><span class="p">:</span>
            <span class="n">checkname</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;checkpoint_</span><span class="si">{model_name}</span><span class="s2">_epoch</span><span class="si">{epoch}</span><span class="s2">.pt&quot;</span>
            <span class="n">checkpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">checkname</span><span class="p">)</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">checkpoint</span><span class="p">,</span> <span class="n">checkpath</span><span class="p">)</span></div>

<div class="viewcode-block" id="Model.fit"><a class="viewcode-back" href="../../../source/package.html#sentarget.models.model.Model.fit">[docs]</a>    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_iterator</span><span class="p">,</span> <span class="n">eval_iterator</span><span class="p">,</span>
            <span class="n">criterion</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">crit_eval</span><span class="o">=</span><span class="s1">&#39;accuracy&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Train and evaluate a model X times. During the training, both training</span>
<span class="sd">        and evaluation results are saved under the `performance` attribute.</span>

<span class="sd">        Args:</span>
<span class="sd">            train_iterator (Iterator): iterator containing batch samples of data.</span>
<span class="sd">            eval_iterator (Iterator): iterator containing batch samples of data.</span>
<span class="sd">            epochs (int): number of times the model will be trained.</span>
<span class="sd">            criterion (Loss): loss function to measure scores.</span>
<span class="sd">            optimizer (Optimizer): optimizer used during training to update weights.</span>
<span class="sd">            verbose (bool, optional): if ``True`` display a progress bar and metrics at each epoch.</span>
<span class="sd">                                        The default is ``True``.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Model: the best model evaluated.</span>

<span class="sd">        Examples::</span>

<span class="sd">            &gt;&gt;&gt; model = MyModel()</span>
<span class="sd">            &gt;&gt;&gt; # Train &amp; eval EPOCHS times</span>
<span class="sd">            &gt;&gt;&gt; criterion = nn.CrossEntropyLoss()</span>
<span class="sd">            &gt;&gt;&gt; optimizer = optim.Adam(model.parameters())</span>
<span class="sd">            &gt;&gt;&gt; EPOCHS = 10</span>
<span class="sd">            &gt;&gt;&gt; model.fit(train_iterator, eval_iterator, epochs=EPOCHS, criterion=criterion, optimizer=optimizer)</span>
<span class="sd">                Epoch:        1/10</span>
<span class="sd">                Training:     100% | [==================================================]</span>
<span class="sd">                Evaluation:   100% | [==================================================]</span>
<span class="sd">                Stats Training:    | Loss: 0.349 | Acc: 84.33% | Prec.: 84.26%</span>
<span class="sd">                Stats Evaluation:  | Loss: 0.627 | Acc: 72.04% | Prec.: 72.22%</span>
<span class="sd">            &gt;&gt;&gt; # ...</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="c1"># Keep track of the best model</span>
        <span class="n">best_model</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">best_eval_accuracy</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="c1"># Default update rules</span>
        <span class="n">criterion</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">CrossEntropyLoss</span><span class="p">()</span> <span class="k">if</span> <span class="n">criterion</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">criterion</span>
        <span class="n">optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">())</span> <span class="k">if</span> <span class="n">optimizer</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">optimizer</span>

        <span class="c1"># Train and evaluate the model epochs times</span>
        <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">epochs</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Epoch:</span><span class="se">\t</span><span class="si">{0:3d}</span><span class="s2">/</span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">epoch</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">epochs</span><span class="p">))</span>

            <span class="c1"># Train and evaluate the model</span>
            <span class="n">results_train</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">train_iterator</span><span class="p">,</span> <span class="n">criterion</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;verbose&#39;</span><span class="p">:</span> <span class="n">verbose</span><span class="p">})</span>
            <span class="n">results_eval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">eval_iterator</span><span class="p">,</span> <span class="n">criterion</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;verbose&#39;</span><span class="p">:</span> <span class="n">verbose</span><span class="p">})</span>
            <span class="c1"># Update the eval dictionary by adding the results at the</span>
            <span class="c1"># current epoch</span>
            <span class="n">append2dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">performance</span><span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">],</span>
                        <span class="n">results_train</span><span class="p">)</span>
            <span class="n">append2dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">performance</span><span class="p">[</span><span class="s2">&quot;eval&quot;</span><span class="p">],</span>
                        <span class="n">results_eval</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> Stats Train: | &quot;</span> <span class="o">+</span> <span class="n">describe_dict</span><span class="p">(</span><span class="n">results_train</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">  Stats Eval: | &quot;</span> <span class="o">+</span> <span class="n">describe_dict</span><span class="p">(</span><span class="n">results_eval</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">()</span>
            <span class="c1"># We copy in memory the best model</span>
            <span class="k">if</span> <span class="n">best_eval_accuracy</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">performance</span><span class="p">[</span><span class="s2">&quot;eval&quot;</span><span class="p">][</span><span class="n">crit_eval</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">best_eval_accuracy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">performance</span><span class="p">[</span><span class="s2">&quot;eval&quot;</span><span class="p">][</span><span class="n">crit_eval</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">best_model</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_update_checkpoint</span><span class="p">(</span><span class="n">epoch</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">criterion</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">,</span>
                                        <span class="n">results_train</span><span class="o">=</span><span class="n">results_train</span><span class="p">,</span> <span class="n">results_eval</span><span class="o">=</span><span class="n">results_eval</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">performance</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

        <span class="k">return</span> <span class="n">best_model</span></div>

<div class="viewcode-block" id="Model.describe_performance"><a class="viewcode-back" href="../../../source/package.html#sentarget.models.model.Model.describe_performance">[docs]</a>    <span class="k">def</span> <span class="nf">describe_performance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get a display of the last performance for both train and eval.</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple: two strings showing statistics for train and eval sessions.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dict_train</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">performance</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">performance</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">performance</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="n">dict_eval</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">performance</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">performance</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">performance</span><span class="p">[</span><span class="s1">&#39;eval&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="k">return</span> <span class="n">describe_dict</span><span class="p">(</span><span class="n">dict_train</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span> <span class="n">describe_dict</span><span class="p">(</span><span class="n">dict_eval</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="Model.state_json"><a class="viewcode-back" href="../../../source/package.html#sentarget.models.model.Model.state_json">[docs]</a>    <span class="k">def</span> <span class="nf">state_json</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Return a serialized ``state_dict``, so it can be saved as a ``json``.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">state</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">value</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="k">return</span> <span class="n">state</span></div></div>
</pre></div>

             </article>
             
            </div>
            <footer>
  

  

    <hr>

  

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Lotte Boerboom, Silvia N. W. Hertzberg, Arthur Dujardin.

    </p>
  </div>
    
      <div>
        Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
      </div>
     

</footer>

          </div>
        </div>

        <div class="pytorch-content-right" id="pytorch-content-right">
          <div class="pytorch-right-menu" id="pytorch-right-menu">
            <div class="pytorch-side-scroll" id="pytorch-side-scroll-right">
              
            </div>
          </div>
        </div>
      </section>
    </div>

  


  

     
       <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
         <script src="../../../_static/jquery.js"></script>
         <script src="../../../_static/underscore.js"></script>
         <script src="../../../_static/doctools.js"></script>
         <script src="../../../_static/language_data.js"></script>
         <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
     

  

  <script type="text/javascript" src="../../../_static/js/vendor/popper.min.js"></script>
  <script type="text/javascript" src="../../../_static/js/vendor/bootstrap.min.js"></script>
  <script type="text/javascript" src="../../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

  <!-- Begin Footer -->

  <div class="container-fluid docs-tutorials-resources" id="docs-tutorials-resources">
    <div class="container">
      <div class="row">
        <div class="col-md-4 text-center">
          <h2>Docs</h2>
          <p>Access comprehensive developer documentation for PyTorch</p>
          <a class="with-right-arrow" href="https://pages.github.uio.no/arthurd/in5550-exam/">View Docs</a>
        </div>

        <div class="col-md-4 text-center">
          <h2>Tutorials</h2>
          <p>Get in-depth tutorials for beginners and advanced developers</p>
          <a class="with-right-arrow" href="https://pages.github.uio.no/arthurd/in5550-exam/source/tutorial.html">View Tutorials</a>
        </div>

        <div class="col-md-4 text-center">
          <h2>Resources</h2>
          <p>Check the GitHub page and contribute to the project</p>
          <a class="with-right-arrow" href="https://pages.github.uio.no/arthurd/in5550-exam/source/package.html">View GitHub</a>
        </div>
      </div>
    </div>
  </div>

  <footer class="site-footer">
    <div class="container footer-container">
      <div class="footer-logo-wrapper">
        <a href="https://pages.github.uio.no/arthurd/in5550-exam/" class="footer-logo"></a>
      </div>

      <div class="footer-links-wrapper">
        <div class="footer-links-col">
          <ul>
            <li class="list-title"><a href="https://pages.github.uio.no/arthurd/in5550-exam/">PyTorch</a></li>
            <li><a href="https://pages.github.uio.no/arthurd/in5550-exam/source/getting-started.html">Get Started</a></li>
            <li><a href="https://arthurdujardin.com/projects/sentarget.html">Blog</a></li>
          </ul>
        </div>

        <div class="footer-links-col">
          <ul>
            <li><a href="https://pages.github.uio.no/arthurd/in5550-exam/source/tutorial.html">Tutorials</a></li>
            <li><a href="https://pages.github.uio.no/arthurd/in5550-exam/">Docs</a></li>
            <li><a href="https://github.uio.no/arthurd/in5550-exam/issues" target="_blank">Github Issues</a></li>
          </ul>
        </div>

      </div>
    </div>
  </footer>

  <div class="cookie-banner-wrapper">
  <div class="container">
    <p class="gdpr-notice">To analyze traffic and optimize your experience, we serve cookies on this site. By clicking or navigating, you agree to allow our usage of cookies. As the current maintainers of this site, Facebook’s Cookies Policy applies. Learn more, including about available controls: <a href="https://www.facebook.com/policies/cookies/">Cookies Policy</a>.</p>
    <img class="close-button" src="../../../_static/images/pytorch-x.svg">
  </div>
</div>

  <!-- End Footer -->

  <!-- Begin Mobile Menu -->

  <div class="mobile-main-menu">
    <div class="container-fluid">
      <div class="container">
        <div class="mobile-main-menu-header-container">
          <a class="header-logo" href="https://pages.github.uio.no/arthurd/in5550-exam/" aria-label="PyTorch"></a>
          <a class="main-menu-close-button" href="#" data-behavior="close-mobile-menu"></a>
        </div>
      </div>
    </div>

    <div class="mobile-main-menu-links-container">
      <div class="main-menu">
        <ul>
          <li>
            <a href="https://pages.github.uio.no/arthurd/in5550-exam/source/getting-started.html">Get Started</a>
          </li>


          <li>
            <a href="https://arthurdujardin.com/projects/sentarget.html">Blog</a>
          </li>

          <li>
            <a href="https://pages.github.uio.no/arthurd/in5550-exam/source/tutorial.html">Tutorials</a>
          </li>

          <li>
            <a href="https://pages.github.uio.no/arthurd/in5550-exam/">Docs</a>
          </li>

          <li>
            <a href="https://github.uio.no/arthurd/in5550-exam">Github</a>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- End Mobile Menu -->

  <script type="text/javascript" src="../../../_static/js/vendor/anchor.min.js"></script>

  <script type="text/javascript">
    $(document).ready(function() {
      mobileMenu.bind();
      mobileTOC.bind();
      pytorchAnchors.bind();
      sideMenus.bind();
      scrollToAnchor.bind();
      highlightNavigation.bind();
      mainMenuDropdown.bind();

      // Add class to links that have code blocks, since we cannot create links in code blocks
      $("article.pytorch-article a span.pre").each(function(e) {
        $(this).closest("a").addClass("has-code");
      });
    })
  </script>
</body>
</html>